# BlockIpHelper

自用工具, 生成某些安全设备批量封禁IP的csv文件

本工具仅用于地址分类和生成csv文件, 无其他用途

### 功能

* 可以导入白名单, 生成模板时排除白名单地址, 避免误封

* 使用本地ip2region的xdb数据库, 毫秒级查询IP归属地, 并导出分类文件

* 生成某些设备黑名单导入模板, 默认国内地址封禁30天, 国外地址永久封禁

### 目前支持的设备模板:

* k01

* 明御防火墙

### 使用说明

#### 下载二进制文件, 或修改代码自行编译

> 命令行支持 `-gen` 和 `-imp` 两个选项, 处理的文件均需要放到 `./data` 目录下

* `-imp white` 可以导入 whitelist.txt 内白名单地址

* `-gen source` 可以将纯真IP导出的 source.txt 转化为 ip_source.txt

* `-gen merge` 可以将纯真IP导出的 source.txt 转化为 ip_merge.txt

* `-gen xdb` 可以将上述生成的 ip_merge.txt文 件转化为 ip2region.xdb 文件

```cmd
.\BlockIpHelper.exe -imp

flag needs an argument: -imp
Usage of D:\mycode\BlockIpHelper\BlockIpHelper.exe:
  -gen string
        merge   纯真IP源文件(./data/source.txt)生成的xdb源文件(./data/ip_merge.txt)
        xdb     xdb源文件(./data/ip_merge.txt)生成ip2region的xdb文件(./data/ip2region.xdb)
  -imp string
        white   导入白名单(./data/whitelist.txt)
```

#### 导入白名单, 支持单个地址和CIDR

```cmd
 .\BlockIpHelper.exe -imp white

2023/08/15 11:24:04 开始导入白名单 ...
2023/08/15 11:24:04 121.0.0.0/8 已添加到数据库白名单地址表中
2023/08/15 11:24:04 209.86.118.253 已添加到数据库白名单地址表中
```

#### 运行后自动分类白名单, 国内攻击, 国外攻击, 生成对应 txt 文件

使用本地 ip2region.xdb 数据库判断归属地, 归属地离线数据来源于纯真IP社区版(2023.08.09)

target 为 10000 条测试数据, 仅需1秒左右即可完成分类并生成对应模板文件

```cmd
 .\BlockIpHelper.exe

...
...
184.187.205.75非白名单的地址, 进行分类
209.86.118.253白名单地址, 跳过
2.130.251.29非白名单的地址, 进行分类
12.250.232.81非白名单的地址, 进行分类
2023/08/15 11:26:49 #############################################################
2023/08/15 11:26:49 目标地址列表存在白名单地址, 保存到 白名单IP.txt 文件
2023/08/15 11:26:49 #############################################################
2023/08/15 11:26:49 已完成地址分类: 白名单IP.txt, 国内攻击IP.txt, 国外攻击IP.txt
2023/08/15 11:26:49 #############################################################
2023/08/15 11:26:49 尝试生成k01黑名单导入文件 k01Block.csv
2023/08/15 11:26:49 #############################################################
2023/08/15 11:26:49 尝试生成明防御防火墙黑名单导入文件 myFwBlock.csv
2023/08/15 11:26:49 #############################################################
2023/08/15 11:26:49 本次处理10000个地址, 耗时1.0198589s
```

### 使用的第三方库

* [Gorm](https://github.com/go-gorm/gorm)

* [Sqlite](https://github.com/glebarez/sqlite)

* [ip2region](https://github.com/lionsoul2014/ip2region)
